@using Eco.MVC
@using System.Globalization
@using StreamingAppGenericAPIAndControllers
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.AspNetCore.Localization
@* NOTE!! this page is rendered in MVC to load the Angular client *@

@model AngularModel
@{
  string userlanguage = "en";
  ViewBag.Title = "AngularView";
  if (!string.IsNullOrEmpty(Model.SysCultureIfSet))
  {
    userlanguage = Model.SysCultureIfSet;
  }
  else
  {
    var requestCulture = this.Context.Features.Get<IRequestCultureFeature>();
    if (requestCulture != null)
    {
      userlanguage = requestCulture.RequestCulture.Culture.Name; // swithched from TwoLetterISOLanguageName
    }
  }

  CultureInfo userCulture;
  try
  {
    userCulture = CultureInfo.CreateSpecificCulture(userlanguage);    
  }
  catch
  {
    userCulture = CultureInfo.CreateSpecificCulture("en");
  }
}

@* Start of section definition!! *@
@section Scripts {
  <!-- Angular client scripts -->
  <script src="~/client-app-bundles/angular.core.bundle.js"></script>
  <script src="~/client-app-bundles/angular.ui.bundle.js"></script>
  <script src="~/js/i18n/angular-locale_@(userCulture.ToString().ToLower()).js"></script>
  <script src="~/Scripts/rx.js" type="text/javascript"></script>
  <script src="@Url.Content("~/client-app-bundles/angular.app.bundle.js?v="+@ViewBag.Version)"></script>



  @ViewOverrideLogic.Get_EXT_AppWideIncludes()
  @ViewOverrideLogic.Get_EXT_ComponentsScripts()
  <!--  Angular client scripts END -->
}
@* End of section definition!! *@

<!-- All content except the global navigation actions (usually at the top) -->
<div ng-app="MDrivenAngularApp"
@* ng-app defines where the Angular code starts it's DOM search *@
     ng-model-options="{'updateOn': 'default blur click', 'debounce': {'default': 1000, 'blur': 0, 'click': 50}}"
@* Wait 1 second before sending changes to server (if not user leaves control) *@
@* Only wait 50 ms if the user clicks, clicking should feel immediate *@
     ng-view>
  @* ng-view is where the Angular view template is inserted. (The View is generated by MDriven) *@
  @* The Angular view template is generated serverside from AngularPageDynamicTemplate.cshtml or AngularModalPageDynamicTemplate.cshtml *@
  @* NOTE!! It's NOT inserted serverside, it's inserted client-side, by the AngularJS code *@
  @*<div class="n-tk-view" ng-view "></div>*@
</div>
